@tailwind base;
@tailwind components;
@tailwind utilities;

/* Design CSS Variables - exact match from design */
:root {
  --font-sans: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  --color-white: #fff;
  --spacing: 0.25rem;
  --container-4xl: 56rem;
  --text-xl: 1.25rem;
  --text-xl--line-height: calc(1.75 / 1.25);
  --text-2xl: 1.5rem;
  --text-2xl--line-height: calc(2 / 1.5);
  --text-4xl: 2.25rem;
  --text-4xl--line-height: calc(2.5 / 2.25);
  --text-5xl: 3rem;
  --text-5xl--line-height: 1;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-bold: 700;
  --leading-relaxed: 1.625;
  --radius-md: 0.375rem;
  --radius-lg: 0.5rem;
  --radius-xl: 0.75rem;
  --radius-2xl: 1rem;
  --radius-4xl: 2rem;
  --default-transition-duration: 150ms;
  --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  --default-font-family: var(--font-sans);
}

@layer base {
  .font-roboto {
    font-family: 'Roboto', sans-serif;
  }
}

@layer components {
  .container {
    @apply mx-auto px-10 lg:px-4 max-w-full md:max-w-[112.5rem];
  }

  .container-max {
    @apply mx-auto;
  }

  /* Floating label styles - exact match from design */
  .floating-label-group {
    position: relative;
  }

  /* Prevent form element layout shifts */
  .floating-label-group input,
  .floating-label-group select {
    min-height: 3.5rem;
  }

  .floating-label {
    position: absolute;
    pointer-events: none;
    left: 2.25rem;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.2s ease;
    font-size: 1.94rem;
    color: #666666;
    padding: 0 0.25rem;
  }

  @media (max-width: 639px) {
    .floating-label {
      font-size: 2.4rem;
    }
  }

  /*
   * CSS FALLBACK RULES - Pure CSS floating labels (from design)
   * These work even if JavaScript fails or is disabled
   */
  .floating-label-group input:focus ~ .floating-label,
  .floating-label-group input:not(:placeholder-shown) ~ .floating-label,
  .floating-label-group select:focus ~ .floating-label,
  .floating-label-group select:valid ~ .floating-label,
  .floating-label-group.input-focused .floating-label,
  .floating-label-group.has-value .floating-label {
    top: 1.2rem;
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #976987; /* match design - purple when floating */
    z-index: 1;
  }

  /* Additional fallback rules for span elements - matching design exactly */
  .floating-label-group input:focus ~ .floating-label,
  .floating-label-group input:not(:placeholder-shown) ~ .floating-label,
  .floating-label-group select:focus ~ .floating-label,
  .floating-label-group select:valid ~ .floating-label,
  .floating-label-group input:focus ~ span,
  .floating-label-group input:not(:placeholder-shown) ~ span,
  .floating-label-group select:focus ~ span,
  .floating-label-group select:valid ~ span,
  .floating-label-group.input-focused .floating-label,
  .floating-label-group.input-focused span,
  .floating-label-group.has-value .floating-label,
  .floating-label-group.has-value span {
    font-size: 1.2rem;
    color: #976987;
    z-index: 1;
  }

  /* Focus state for inputs and selects - fallback */
  .floating-label-group input:focus,
  .floating-label-group select:focus {
    border-color: #976987; /* match design focus border color */
  }

  /* Specific fallback rules for ZIP code and CVV fields - matching design exactly */
  #zip:placeholder-shown ~ .floating-label,
  #billing-zip:placeholder-shown ~ .floating-label,
  #cvv:placeholder-shown ~ .floating-label {
    /* Default placeholder state - no special positioning needed */
  }

  /* When ZIP code or CVV is focused or has value, use the same floating position as other fields */
  #zip:focus ~ .floating-label,
  #zip:not(:placeholder-shown) ~ .floating-label,
  #billing-zip:focus ~ .floating-label,
  #billing-zip:not(:placeholder-shown) ~ .floating-label,
  #cvv:focus ~ .floating-label,
  #cvv:not(:placeholder-shown) ~ .floating-label {
    top: 1.2rem;
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #976987;
    background: white;
    z-index: 1;
  }

  /*
   * JAVASCRIPT ENHANCEMENT RULES - Higher specificity overrides
   * These provide enhanced reliability when JavaScript is working
   */
  .floating-label-group.always-float .floating-label {
    top: 1.2rem !important;
    transform: translateY(-50%) !important;
    font-size: 1.2rem !important;
    color: #976987 !important; /* match design - purple when floating */
    z-index: 1 !important;
  }
  /* CollectJS container styling - fixed height to prevent expansion */
  #card-number-field,
  #card-expiry-field,
  #card-cvv-field {
    height: 5.5rem; /* Fixed height to match design py-7 */
    max-height: 5.5rem; /* Prevent any expansion */
    display: flex;
    align-items: stretch;
    padding: 0; /* Remove container padding */
    overflow: hidden; /* Prevent iframe from expanding container */
  }

  /* Match floating labels to rest of form styling */
  .floating-label-group:has(#card-number-field) .floating-label,
  .floating-label-group:has(#card-expiry-field) .floating-label,
  .floating-label-group:has(#card-cvv-field) .floating-label {
    top: 1.2rem; /* Match standard form floating label position */
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #976987; /* Match design focus color like other form labels */
    z-index: 1;
  }

  /* Highlight border on focus within iframe */
  .floating-label-group:has(#card-number-field):focus-within > #card-number-field,
  .floating-label-group:has(#card-expiry-field):focus-within > #card-expiry-field,
  .floating-label-group:has(#card-cvv-field):focus-within > #card-cvv-field {
    border-color: #976987;
  }

  /* Fixed iframe height to prevent expansion */
  #card-number-field iframe,
  #card-expiry-field iframe,
  #card-cvv-field iframe {
    height: 5.5rem !important;
    max-height: 5.5rem !important;
    width: 100% !important;
    border: none !important;
    overflow: hidden !important;
  }

  @media (max-width: 639px) {
    .floating-label-group:has(#card-number-field) .floating-label,
    .floating-label-group:has(#card-expiry-field) .floating-label,
    .floating-label-group:has(#card-cvv-field) .floating-label {
      top: 1.2rem; /* Match standard form mobile positioning */
      font-size: 1.2rem; /* Consistent mobile font size */
    }
  }


  .floating-label-group input:focus ~ .floating-label,
  .floating-label-group input:not(:placeholder-shown) ~ .floating-label,
  .floating-label-group select:focus ~ .floating-label,
  .floating-label-group select:valid ~ .floating-label,
  .floating-label-group input:focus ~ span,
  .floating-label-group input:not(:placeholder-shown) ~ span,
  .floating-label-group select:focus ~ span,
  .floating-label-group select:valid ~ span {
    font-size: 1.2rem;
    color: #976987;
    z-index: 1;
  }

  .floating-label-group input:focus,
  .floating-label-group select:focus {
    border-color: #976987;
  }

  /* Adjust ZIP code and CVV labels in their default placeholder state */
  #zipCode:placeholder-shown ~ .floating-label,
  #cvv:placeholder-shown ~ .floating-label {
    /* Additional styling if needed */
  }

  /* When ZIP code or CVV is focused or has value, use the same floating position as other fields */
  #zipCode:focus ~ .floating-label,
  #zipCode:not(:placeholder-shown) ~ .floating-label,
  #cvv:focus ~ .floating-label,
  #cvv:not(:placeholder-shown) ~ .floating-label {
    top: 1.2rem;
    transform: translateY(-50%);
    font-size: 1.2rem;
    color: #976987;
    background: white;
    z-index: 1;
  }

  /* Error state styles */
  .input-error {
    border-color: #dc2626 !important;
  }

  .error-message {
    color: #dc2626;
    font-size: 1.75rem;
    margin-top: 0.5rem;
    font-weight: 600;
    margin-left: 5%;
  }

  /* Remove these rules that shift labels on error - they cause content jump */
  /* .floating-label-group:has(.input-error:placeholder-shown) label.floating-label {
    top: 37% !important;
  }

  .floating-label-group:has(.input-error:placeholder-shown) input:focus ~ .floating-label span {
    top: 37% !important;
  } */

  .floating-label-group input:focus ~ .floating-label span,
  .floating-label-group input:not(:placeholder-shown) ~ .floating-label,
  .floating-label-group input:not(:placeholder-shown) ~ .floating-label span {
    font-size: 1.2rem;
    color: #976987;
    z-index: 1;
  }

  /* Google Places Autocomplete dropdown */
  .pac-container {
    z-index: 1051;
    border-radius: 0.75rem;
    border: 3px solid #cdcdcd;
    margin-top: 0.5rem;
    font-family: inherit;
  }

  .pac-item {
    padding: 0.75rem 1rem;
    font-size: 1.6rem;
    border-bottom: 1px solid #e5e5e5;
  }

  .pac-item:hover {
    background-color: #f5f5f5;
  }

  .pac-item-selected {
    background-color: #e5e5e5;
  }

  /* CollectJS field containers — minimal styling, let CollectJS handle sizing */
  #card-number-field,
  #card-expiry-field,
  #card-cvv-field {
    position: relative;
    z-index: 1;
    width: 100%;
    /* Let CollectJS determine natural height based on its internal padding */
  }

  /* CollectJS iframe styling — inherit from container */
  #card-number-field iframe,
  #card-expiry-field iframe,
  #card-cvv-field iframe {
    width: 100% !important;
    height: 100% !important;
    border: none !important;
    background: transparent !important;
  }

  /* CollectJS iframe sizing — let CollectJS handle dimensions naturally */
  #card-number-field iframe,
  #card-expiry-field iframe,
  #card-cvv-field iframe {
    width: 100% !important;
    border: none !important;
    background: transparent !important;
    display: block !important;
  }

  /* Mobile responsive styling for CollectJS inputs - match design exactly */
  @media (max-width: 639px) {
    #card-number-field iframe input,
    #card-expiry-field iframe input,
    #card-cvv-field iframe input {
      font-size: 41.6px !important;
      line-height: 1 !important;
      color: #666666 !important;
      font-weight: 400 !important;
    }
  }

  /* Desktop styling for CollectJS inputs - match design exactly */
  @media (min-width: 640px) {
    #card-number-field iframe input,
    #card-expiry-field iframe input,
    #card-cvv-field iframe input {
      font-size: 31.04px !important;
      line-height: 1 !important;
      color: #666666 !important;
      font-weight: 400 !important;
      padding: 28px 36px !important;
    }
  }



  .form-select {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAQCAYAAAAMJL+VAAAABGdBTUEAALGPC/xhBQAAAQtJREFUOBG1lEEOgjAQRalbGj2OG9caOACn4ALGtfEuHACiazceR1PWOH/CNA3aMiTaBDpt/7zPdBKy7M/DCL9pGkvxxVp7KsvyJftL5rZt1865M+Ucq6pyyF3hNcI7Cuu+728QYn/JQA5yKaempxuZmQngOwEaYx55nu+1lQh8GIatMGi+01NwBcEmhxBqK4nAPZJ78K0KKFAJmR3oPp8+Iwgob0Oa6+TLoeCvRx+mTUYf/FVBGTPRwDkfLxnaSrRwcH0FWhNOmrkWYbE2XEicqgSa1J0LQ+aPCuQgZiLnwewbGuz5MGoAhcIkCQcjaTBjMgtXGURMVHC1wcQEy0J+Zlj8bKAnY1/UzDe2dbAVqfXn6wAAAABJRU5ErkJggg==");
    background-size: 1.8rem;
    background-position: right 1.7rem center;
  }

  /* Viewport-based font sizing */
  html {
    font-size: 2.1vw;
  }

  @media (min-width: 768px) {
    html {
      font-size: 0.738vw;
    }
  }

  /* Limit viewport-based font sizes on large screens */
  @media (min-width: 1600px) {
    html {
      font-size: 11.8px !important;
    }
  }

  /* Prevent layout shift for logo */
  img.w-110 {
    aspect-ratio: 220 / 60;
    height: auto;
    display: block;
    min-height: 60px;
  }

  /* Correct aspect ratio for 6-bottles image */
  img[src*="6-bottles"] {
    aspect-ratio: 181 / 144;
    object-fit: contain;
  }

  /* CollectJS StyleSniffer Approach - NMI Official Method */
  /* Style the containers and let styleSniffer inherit to iframes */

  .collectjs-field {
    /* Match exact styling from form inputs above */
    width: 100%;
    border: 2px solid #CDCDCD;
    border-radius: 12px; /* rounded-xl */
    background-color: #F9F9F9; /* bg-[#F9F9F9] */
    color: #666666; /* text-[#666666] */
    line-height: 1; /* leading-none */
    box-sizing: border-box;
    min-height: 79px; /* Ensure consistent height to prevent layout shift */
    transition: border-color 0.3s ease; /* Only animate border color */

    /* Responsive font sizing - matches form inputs exactly */
    font-size: 2.6rem; /* Mobile: text-[2.6rem] */
    padding: 1.75rem 2.5rem 1.75rem 3rem; /* Mobile: py-7 px-9 with 3rem left padding to indent CollectJS inputs */
  }

  /* Card number field specific styling - matches form input padding */
  .collectjs-card-number {
    padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
    padding-right: 10rem; /* pr-40 - space for card brand icons */
  }

  /* CVV field specific styling - matches form input padding */
  .collectjs-cvv {
    padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
    padding-right: 4.25rem; /* pr-17 - space for info icon */
  }

  /* Tablet responsive styling */
  @media (min-width: 480px) and (max-width: 639px) {
    .collectjs-field {
      font-size: 2.2rem;
      padding: 1.6rem 2.5rem 1.6rem 3rem; /* 3rem left padding to indent CollectJS inputs */
    }

    .collectjs-card-number {
      padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
      padding-right: 9rem;
    }

    .collectjs-cvv {
      padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
      padding-right: 3.8rem;
    }
  }

  /* Desktop responsive styling - matches form inputs exactly */
  @media (min-width: 640px) {
    .collectjs-field {
      font-size: 1.94rem; /* Desktop: sm:text-[1.94rem] */
      padding: 1.75rem 2.5rem 1.75rem 3rem; /* py-7 with 3rem left padding to indent CollectJS inputs */
    }

    .collectjs-card-number {
      padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
      padding-right: 10rem; /* pr-40 */
    }

    .collectjs-cvv {
      padding-left: 3rem; /* 3rem left padding to indent CollectJS inputs */
      padding-right: 4.25rem; /* pr-17 */
    }
  }

  /* Large screens */
  @media (min-width: 1200px) {
    .collectjs-field {
      font-size: 1.8rem;
      max-width: 650px;
    }
  }

  /* Focus styling to match form inputs */
  .collectjs-field:focus-within {
    outline: none; /* focus:outline-0 */
  }

  /* CollectJS iframe styling with padding */
  .collectjs-field iframe {
    border: none !important;
    background: transparent !important;
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    padding: 2.5rem 0rem !important;
    line-height: 1.5 !important;
  }

  /* Target CollectJS iframes directly for additional padding control */
  #card-number-field iframe {
    padding: 0.5rem 4rem 1rem 2.30rem !important;
    line-height: 1.2 !important;
    min-height: 3.5rem !important;
  }

  #card-expiry-field iframe, 
  #card-cvv-field iframe {
    padding: .3rem 4rem 1rem 2.30rem !important;
    line-height: 1.2 !important;
    min-height: 3.5rem !important;
  }
  
  /* Prevent content shift when validation error occurs */
  .collectjs-field.input-error iframe {
    padding-top: 0.5rem !important;
    padding-bottom: 1rem !important;
  }
  
  #card-number-field.input-error iframe {
    padding: 0.5rem 4rem 1rem 2.30rem !important;
  }
  
  #card-expiry-field.input-error iframe,
  #card-cvv-field.input-error iframe {
    padding: .3rem 4rem 1rem 2.30rem !important;
  }

  /* Countdown timer - exact match from design */
  .countdown-timer {
    font-variant-numeric: tabular-nums;
  }

  /* Validation error styles - exact match from design */
  .input-error {
    border-color: #dc2626 !important;
  }

/* Header specific constraints to mirror design */
@media (min-width: 1024px) {
  header {
    max-height: 120px;
    overflow: hidden;
  }
  header .container {
    padding-top: 1rem !important;
    padding-bottom: 1rem !important;
  }
  header img.w-110 {
    max-width: 200px;
    width: 200px;
    height: 41.55px; /* maintain logo aspect ratio */
    min-height: 41.55px;
    display: block;
  }
  /* Thin the timer bubble slightly on lg to match design visuals */
  header .py-5\.5 {
    padding-top: 0.75rem !important;
    padding-bottom: 0.75rem !important;
  }
}

  .error-message {
    color: #dc2626;
    font-size: 1.75rem;
    margin-top: 0.5rem;
  }
}

/* Simple input validation styles - KISS approach */
@layer utilities {
  /* Use HTML5 validation pseudo-classes for automatic validation */
  input:required:valid:not(:focus):not(:placeholder-shown) {
    @apply border-green-500 !important;
  }
  
  input:required:invalid:not(:focus):not(:placeholder-shown) {
    @apply border-red-500 !important;
  }
  
  /* Email-specific validation */
  input[type="email"]:valid:not(:focus):not(:placeholder-shown) {
    @apply border-green-500 !important;
  }
  
  input[type="email"]:invalid:not(:focus):not(:placeholder-shown) {
    @apply border-red-500 !important;
  }
  
  /* Phone/tel validation */
  input[type="tel"]:valid:not(:focus):not(:placeholder-shown) {
    @apply border-green-500 !important;
  }
  
  /* Focus state always takes precedence */
  input:focus {
    @apply border-blue-500 !important;
  }
}

/* Card icons styling */
.card-icons {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-left: auto;
}

.card-icons img {
  height: 24px;
  width: auto;
  transition: all 0.3s ease;
}

/* Card icons are always visible - CollectJS doesn't support real-time card type detection */

